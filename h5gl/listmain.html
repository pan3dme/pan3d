<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">-->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <title>H5页面优化</title>

    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.10.1/dist/av-min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@5.0.0-beta.0/dist/browser/lc.min.js"></script>

   
    <!-- <script src="bins/av/jquery.min.js"></script>
    <script src="bins/av/bootstrap.min.js"></script>
    <script src="bins/av/av-min.js"></script>
    <script src="bins/av/lc.min.js"></script> -->
 

    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: gainsboro;
        }

        .wrap {
            height: 100%;
        }

        #nav ul {
            margin: 10px;
        }

        #title {
            width: 100%;
            height: 40px;
            font-size: 28px;
            background-color: red;
        }

        #nav {
            width: 100%;
            height: 20%;
            background-color: white;
        }

        #nav li {
            display: inline-block;
            width: 25%;
            height: 20%;
            float: left;

        }

        #nav li a {
            color: #0f0f0f;
            text-align: center;
            font-size: 20px;
        }

        #nav ul li a:hover {
            color: red;
        }

        /*通过span设置下划线*/
        #nav ul li a:hover span {
            padding-bottom: 17px;
            border-bottom: 2px solid;
        }

        .item {
            padding: 40px;
            margin-left: 20px;
            margin-top: 20px;
            margin-right: 20px;
            margin-bottom: 20px;
            border-radius: 20px;
        
            background: rgb(253, 253, 253);
        }

        .i1 {
            padding: 40px;
            margin-top: 40px;
            margin-right: 40px;
            margin-bottom: 40px;
            border-radius: 25px;
            background: rgb(158, 158, 158);

        }

        .i1Copy {
            padding: 40px;
            margin-top: 40px;
            margin-right: 40px;
            margin-bottom: 40px;
            border-radius: 25px;
            background: red url('https://webpan.oss-cn-shanghai.aliyuncs.com/res/pan/test/iosmetia/pic/pic001.jpg') no-repeat right center;

        }
    </style>
</head>

<body onload='init()'>
    <div class="wrap">

        <div id="title">
            我是标题1.404
        </div>

        <div id="nav">
            <ul class="nav nav-bar">
                <li><a href="#" onclick="getListDataAll()"><span>全部</span></a></li>
                <li><a href="#" onclick="getListDataAll()"><span>场景</span></a></li>
                <li><a href="#" onclick="show3()"><span>角色</span></a></li>
                <li><a href="#" onclick="show4()"><span>特效</span></a></li>
            </ul>
        </div>

        <div id="content" style="font-size: 20px">
            <b id="list" style="list-style: none ">

            </b>
        </div>

    </div>


</body>

<script>
    
    // alert("script_base");

    var fileRoot = "https://webpan.oss-cn-shanghai.aliyuncs.com/res/";
 
  
    function json2str(o) {
        var arr = [];
        var fmt = function (s) {
            if (typeof s == 'object' && s != null) return json2str(s);
            return /^(string|number)$/.test(typeof s) ? "'" + s + "'" : s;
        }
        for (var i in o) arr.push("'" + i + "':" + fmt(o[i]));
        return '{' + arr.join(',') + '}';
    }
    function init() {
        
        // localStorage.setItem('debug', 'leancloud*');
        alert(window.localStorage);
        alert(window.localStorage.setItem);
 AV.init({
     appId: "tQdDwaHgg6hNEuYG4WhFlLQ0-gzGzoHsz",
     appKey: "Kc3v7hICoaQcO80skdhOXCrl",
     serverURL: "https://tqddwahg.lc-cn-n1-shared.com"
 });


      
        alert("准备请求");
        AV.User.logIn("pan3dme", "1343").then(function (loginedUser) {
            alert("script_登入成功");
            getListDataAll();

        }, function (error) {
            alert(JSON.stringify(error));
        });

    }
    function getListDataAll() {
        $("#list").html('Colud加载中...');
        const query = new AV.Query('pan3dlist002');
        query.descending('createdAt');
        query   .find().then((arr) => {
            showListViewByData(arr);

        });
    }
    function showListViewByData(arr) {

        $("#list").html('');
       
        var str = "";
        for (var i = 0; i < arr.length; i++) {
            var todo = arr[i]
            var tittlestr =  todo.get('title');
            var textstr =  todo.get('text');
            var imgStr = ""

         

            for(var j=0;j<4;j++){
                var imagefile=todo.get("image"+j);
                if(imagefile){
                    imgStr += "<img src='" + imagefile.url()+ "' width='160' height='160' />";
                imgStr += "    ";
                }

            }
         
         
            str = "<li class='item'>" + tittlestr + "<br>" + textstr + "<br>" + imgStr + "</li>";
            $("#list").html($("#list").html() + str);

        }
        $("#content #list .item").click(function () {
            var selectIdx = $(this).index()
            var selectVo = arr[selectIdx];
            // var outStr = json2str({"type":selectVo.get('type'),"sceneinfo":selectVo.get('sceneinfo')});
    
            window.location.href = 'index.html?info=' + selectVo.get('sceneinfo');
        });

    }
     


    function show2() {

        

        $.ajax({
            url: fileRoot + 'pan/test/iosmetia/jason12.xml',    //在后文后有元数据
            type: 'GET',
            dataType: 'json',
            timeout: 1000,
            cache: false,
            beforeSend: LoadFunction, //加载执行方法
            error: erryFunction,  //错误执行方法
            success: succFunction //成功执行方法
        })
        function LoadFunction() {
            $("#list").html('加载中...');
        }
        function erryFunction() {
            alert("error");
        }
        function succFunction(tt) {


            $("#list").html('');

            var str = "";
            var json = eval(tt); //json数组
            $.each(json, function (index) {
                //循环获取数据

                var tittlestr = json[index].tittle;
                var textstr = json[index].text;
                var picitem = json[index].picitem;

                var imgStr = ""

                $.each(picitem, function (picIdx) {

                    var picUrl = fileRoot + picitem[picIdx];
                    imgStr += "<img src='" + picUrl + "' width='160' height='160' />";
                    imgStr += "    ";

                });


                str = "<li class='item'>" + tittlestr + "<br>" + textstr + "<br>" + imgStr + "</li>";



                $("#list").html($("#list").html() + str);


            });


            $("#content #list .item").click(function () {

                var selectIdx = $(this).index()
                var selectVo = json[selectIdx];
                var outStr = json2str(selectVo);
                console.log(selectVo);

                window.location.href = 'index.html?info=' + outStr;
            });

        }
    }//function  show2()  show3()  show4()的实现和show1()原理是一样的，这里就不再写了。

    function show3() {


        $.ajax({
            url: 'https://webpan.oss-cn-shanghai.aliyuncs.com/res/pan/test/iosmetia/data1.json',    //在后文后有元数据
            type: 'GET',
            dataType: 'json',
            timeout: 1000,
            cache: false,
            beforeSend: LoadFunction, //加载执行方法
            error: erryFunction,  //错误执行方法
            success: succFunction //成功执行方法
        })
        function LoadFunction() {
            $("#list").html('加载中...');
        }
        function erryFunction() {
            alert("error");
        }
        function succFunction(tt) {
            $("#list").html('');

            // eval将字符串转成对象数组
            //                var json = { "id": "10086", "uname": "zhangsan", "email": "zhangsan@qq.com" };
            //                json = eval(json);
            //                alert("===json:id=" + json.id + ",uname=" + json.uname + ",email=" + json.email);

            var json = eval(tt); //json数组
            var str = "";

            $.each(json, function (index) {
                //循环获取数据
                var id = json[index].id;
                var name = json[index].name;

                //$("#list").html($("#list").html() + "<br>" + id + " - " + name + "<br/>");
                //alert(id);

                str += "<li class='item'>" + id + "<br>" + name + "</li>";
                $("#list").html($("#list").html() + str);

                //我想其实应该是这样的：当你点击某一项的时候，会进入一个URL，来进行更改数据库的操作。
                //系统怎么识别出来你点击的是哪一项？
                //jQuery中如何判断当前点击的是第几个li，使用$(this).index()取得li的下标

            });

            $("#content #list .item").click(function () {
                alert($(this).index());
                $(this).toggleClass("i1");
            });

        }
    }//function  show2()  show3()  show4()的实现和show1()原理是一样的，这里就不再写了。

</script>

</html>