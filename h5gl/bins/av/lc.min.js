!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LC={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function o(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}var a=function(){function t(){}return Object.defineProperty(t,"isSet",{get:function(){return!!this._adapters},enumerable:!1,configurable:!0}),t.set=function(t){this._adapters&&console.warn("Adapters already set"),this._adapters=t,this._onSet.forEach((function(e){return e(t)}))},t.get=function(){if(!this._adapters)throw new Error("Adapters not set");return this._adapters},t.on=function(t,e){switch(t){case"set":this._onSet.push(e)}},t._onSet=[],t}();function u(t){a.set(t)}var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function h(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function l(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var p=1e3,d=60*p,f=60*d,y=24*f,v=7*y,b=365.25*y,m=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*b;case"weeks":case"week":case"w":return n*v;case"days":case"day":case"d":return n*y;case"hours":case"hour":case"hrs":case"hr":case"h":return n*f;case"minutes":case"minute":case"mins":case"min":case"m":return n*d;case"seconds":case"second":case"secs":case"sec":case"s":return n*p;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===n&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=y)return g(t,e,y,"day");if(e>=f)return g(t,e,f,"hour");if(e>=d)return g(t,e,d,"minute");if(e>=p)return g(t,e,p,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=y)return Math.round(t/y)+"d";if(e>=f)return Math.round(t/f)+"h";if(e>=d)return Math.round(t/d)+"m";if(e>=p)return Math.round(t/p)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function g(t,e,n,r){var o=e>=1.5*n;return Math.round(t/n)+" "+r+(o?"s":"")}var _=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let i;function s(...t){if(!s.enabled)return;const e=s,r=Number(new Date),o=r-(i||r);e.diff=o,e.prev=i,e.curr=r,i=r,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;a++;const i=n.formatters[o];if("function"==typeof i){const n=t[a];r=i.call(e,n),t.splice(a,1),a--}return r}),n.formatArgs.call(e,t);(e.log||n.log).apply(e,t)}return s.namespace=t,s.enabled=n.enabled(t),s.useColors=n.useColors(),s.color=e(t),s.destroy=r,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function o(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(i),...n.skips.map(i).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),o=r.length;for(e=0;e<o;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=m,Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n},w=l((function(t,e){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(o=r))}),e.splice(o,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=_(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})),C=function(){function t(){}return Object.defineProperty(t,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t,"filter",{get:function(){return this._filter},enumerable:!1,configurable:!0}),t.enable=function(t){w.enable(t),this._filter=t,this._enabled=!0,this._onEnable.forEach((function(e){return e(t)}))},t.disable=function(){w.disable(),this._enabled=!1,this._onDisable.forEach((function(t){return t()}))},t.log=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._logger[t]||(this._logger[t]=w(t)),(e=this._logger)[t].apply(e,n)},t.on=function(t,e){switch(t){case"enable":this._onEnable.push(e);break;case"disable":this._onDisable.push(e)}},t._enabled=!1,t._logger={},t._onEnable=[],t._onDisable=[],t}(),T=0;function O(t){return o(this,void 0,void 0,(function(){var e,n,o,s,u;return i(this,(function(i){switch(i.label){case 0:return e=a.get().request,n=A(t),o=++T,C.log("LC:Request:send","%d: %O",o,t),u=k,[4,e(n,r(r({},t.options),{method:t.method||"GET",headers:t.header,data:t.body}))];case 1:return s=u.apply(void 0,[i.sent()]),C.log("LC:Request:recv","%d: %O",o,s),[2,s]}}))}))}function A(t){if(!t.baseURL)throw new Error("Cannot send request: the baseURL is empty");var e=t.baseURL;t.path&&("/"===t.path[0]?e+=t.path:e+="/"+t.path);var n=function(t){var e="";return t&&Object.entries(t).forEach((function(t,n){var r=t[0],o=t[1];void 0!==o&&(n&&(e+="&"),e+=r+"="+encodeURIComponent(o))})),e}(t.query);return n&&(e+="?"+n),e}function k(t){return{status:t.status,header:t.headers,body:t.data}}var S="CURRENT_USER",P="SERVER_URLS";function E(t){if(t.async)throw new TypeError("The adapters provides an async storage, please use async method instead")}var j=function(){function t(){}return t.keyWithNamespace=function(t){return"LC:"+t},t.set=function(t,e){var n=a.get().storage;E(n),t=this.keyWithNamespace(t),n.setItem(t,e),C.log("LC:LocalStorage:set",t,e)},t.get=function(t){var e,n=a.get().storage;E(n),t=this.keyWithNamespace(t);var r=null!==(e=n.getItem(t))&&void 0!==e?e:null;return C.log("LC:LocalStorage:get",t,r),r},t.delete=function(t){var e=a.get().storage;E(e),t=this.keyWithNamespace(t),e.removeItem(t),C.log("LC:LocalStorage:delete",t)},t.setAsync=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=a.get().storage,t=this.keyWithNamespace(t),[4,n.setItem(t,e)];case 1:return r.sent(),C.log("LC:LocalStorage:set",t,e),[2]}}))}))},t.getAsync=function(t){var e;return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return n=a.get().storage,t=this.keyWithNamespace(t),[4,n.getItem(t)];case 1:return r=null!==(e=o.sent())&&void 0!==e?e:null,C.log("LC:LocalStorage:get",t,r),[2,r]}}))}))},t.deleteAsync=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=a.get().storage,t=this.keyWithNamespace(t),[4,e.removeItem(t)];case 1:return n.sent(),C.log("LC:LocalStorage:delete",t),[2]}}))}))},t}(),q=function(){function t(t){this._ns=t}return t.prototype.keyWithNamespace=function(t){return this._ns+":"+t},t.prototype.set=function(t,e){j.set(this.keyWithNamespace(t),e)},t.prototype.get=function(t){return j.get(this.keyWithNamespace(t))},t.prototype.delete=function(t){j.delete(this.keyWithNamespace(t))},t.prototype.setAsync=function(t,e){return j.setAsync(this.keyWithNamespace(t),e)},t.prototype.getAsync=function(t){return j.getAsync(this.keyWithNamespace(t))},t.prototype.deleteAsync=function(t){return j.deleteAsync(this.keyWithNamespace(t))},t}();function x(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}function N(t){return x(t,"Object")}function I(t,e){var n={};return Object.entries(t).forEach((function(t){var r=t[0],o=t[1];return n[r]=e(o,r)})),n}function R(t){return!t||0===Object.keys(t).length}function D(t,e){if(!t)throw new Error(e||"Assertion failed")}function L(t){return"string"==typeof t?t:t.aclKey}function U(t){return"string"==typeof t?t.startsWith("role:")?t:"role:"+t:t.aclKey}var F=function(){function t(){this.data={}}return t.fromJSON=function(e){var n=new t;return Object.entries(e).forEach((function(t){var e=t[0],r=t[1];!0===r.read?n.allow(e,"read"):!1===r.read&&n.deny(e,"read"),!0===r.write?n.allow(e,"write"):!1===r.write&&n.deny(e,"write")})),n},t.prototype.toJSON=function(){return this.data},t.prototype.allow=function(t,e){var n=L(t);return this.data[n]||(this.data[n]={}),this.data[n][e]=!0,this},t.prototype.deny=function(t,e){var n=L(t);return this.data[n]&&(delete this.data[n][e],R(this.data[n])&&delete this.data[n]),this},t.prototype.can=function(t,e){var n=L(t);return Boolean(this.data[n]&&this.data[n][e])},t.prototype.setPublicReadAccess=function(t){return t?this.allow("*","read"):this.deny("*","read")},t.prototype.getPublicReadAccess=function(){return this.can("*","read")},t.prototype.setPublicWriteAccess=function(t){return t?this.allow("*","write"):this.deny("*","write")},t.prototype.getPublicWriteAccess=function(){return this.can("*","write")},t.prototype.setReadAccess=function(t,e){return e?this.allow(t,"read"):this.deny(t,"read")},t.prototype.getReadAccess=function(t){return this.can(t,"read")},t.prototype.setWriteAccess=function(t,e){return e?this.allow(t,"write"):this.deny(t,"write")},t.prototype.getWriteAccess=function(t){return this.can(t,"write")},t.prototype.setRoleReadAccess=function(t,e){var n=U(t);return e?this.allow(n,"read"):this.deny(n,"read")},t.prototype.getRoleReadAccess=function(t){return this.can(U(t),"read")},t.prototype.setRoleWriteAccess=function(t,e){var n=U(t);return e?this.allow(n,"write"):this.deny(n,"write")},t.prototype.getRoleWriteAccess=function(t){return"string"!=typeof t||t.startsWith("role:")||(t="role:"+t),this.can(t,"write")},t}();function M(t){var e=r({},t);return["objectId","createdAt","updatedAt"].forEach((function(t){return delete e[t]})),e}var W=function(){function t(t,e,n){this.app=t,this.className=e,this.objectId=n}return t.prototype.toPointer=function(){return{__type:"Pointer",className:this.className,objectId:this.objectId}},t.prototype.get=function(t){var e,n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"GET",path:"1.1/classes/"+this.className+"/"+this.objectId,query:{keys:null===(e=null==t?void 0:t.keys)||void 0===e?void 0:e.join(","),include:null===(n=null==t?void 0:t.include)||void 0===n?void 0:n.join(","),returnACL:null==t?void 0:t.returnACL},options:t})];case 1:if(R((r=o.sent()).body))throw new Error("The objectId '"+this.objectId+"' is not exists");return[2,$.decodeObject(this.app,r.body,this.className)]}}))}))},t.prototype.update=function(t,e){var n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/classes/"+this.className+"/"+this.objectId,body:$.encode(M(t)),query:{fetchWhenSave:null==e?void 0:e.fetch,where:null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.toString()},options:e})];case 1:return r=o.sent(),[2,$.decodeObject(this.app,r.body,this.className)]}}))}))},t.prototype.delete=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.app.request({method:"DELETE",path:"1.1/classes/"+this.className+"/"+this.objectId,options:t})];case 1:return e.sent(),[2]}}))}))},t}(),B=function(){function t(t,e,n){this._ref=new W(t,e,n)}return t.extractData=function(e){var n=this;return e?e instanceof t?this.extractData(e.data):Array.isArray(e)?e.map((function(t){return n.extractData(t)})):N(e)?I(e,(function(t){return n.extractData(t)})):e:e},Object.defineProperty(t.prototype,"app",{get:function(){return this._ref.app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._ref.className},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectId",{get:function(){return this._ref.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),t.prototype.toPointer=function(){return this._ref.toPointer()},t.prototype.get=function(t){return this._ref.get(t)},t.prototype.update=function(t,e){return this._ref.update(t,e)},t.prototype.delete=function(t){return this._ref.delete(t)},t.prototype.toJSON=function(){var e=t.extractData(this);return e.objectId=this.objectId,this.createdAt&&(e.createdAt=this.createdAt),this.updatedAt&&(e.updatedAt=this.updatedAt),e},t.prototype.toFullJSON=function(){return $.encodeObject(this,!0)},t}(),$=function(){function t(){}return t.setCreator=function(t,e){this._creators.set(t,e)},t.create=function(t,e,n){var r=this._creators.get(e);return r?r(t,n,e):new B(t,e,n)},t.encode=function(t,e){var n=this;return t?t instanceof W?t.toPointer():t instanceof B?this.encodeObject(t,e):t instanceof F?t.toJSON():x(t,"Date")?{__type:"Date",iso:t.toISOString()}:Array.isArray(t)?t.map((function(t){return n.encode(t,e)})):N(t)?I(t,(function(t){return n.encode(t)})):t:t},t.encodeObject=function(t,e){if(!e)return t.toPointer();var n=this.encode(t.data,e);return n.__type="Object",n.className=t.className,n.objectId=t.objectId,t.createdAt&&(n.createdAt=t.createdAt.toISOString()),t.updatedAt&&(n.updatedAt=t.updatedAt.toISOString()),n},t.decode=function(t,e){var n=this;if(!e)return e;switch(e.__type){case"Pointer":case"Object":return this.decodeObject(t,e);case"Date":return new Date(e.iso);case"File":return this.decodeObject(t,e,"_File")}return Array.isArray(e)?e.map((function(e){return n.decode(t,e)})):N(e)?I(e,(function(e){return n.decode(t,e)})):e},t.decodeObject=function(t,e,n){n&&(e.className=n),D(e.className,"Decode failed: the className is empty"),D(e.objectId,"Decode failed: the objectId is empty");var o=this.create(t,e.className,e.objectId);return o.data=r({},e),function t(e,n){if(e)if(Array.isArray(n))n.forEach((function(n){return t(e,n)}));else if(n.includes(".")){var r=n.split(".");t(e[r[0]],r.slice(1).join("."))}else delete e[n]}(o.data,["className","objectId","ACL","__type","createdAt","updatedAt"]),o.data=this.decode(t,o.data),e.createdAt&&(o.createdAt=new Date(e.createdAt)),e.updatedAt&&(o.updatedAt=new Date(e.updatedAt)),e.ACL&&(o.data.ACL=F.fromJSON(e.ACL)),o},t._creators=new Map,t}(),J=function(t){function e(e,n){var r=t.call(this,"code: "+e+", message: "+n)||this;return r.code=e,r.error=n,r}return n(e,t),e}(Error);function z(t){return"-MdYXbMMI"!==("string"==typeof t?t:t.appId).slice(-9)}var K=function(){function t(t){this._refreshing=!1,this._app=t}return t.prototype.getURLs=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._urls?[3,2]:[4,this._app.storage.getAsync(P)];case 1:t=e.sent(),this._urls=t?JSON.parse(t):this.getDefaultServerURLs(),e.label=2;case 2:return Date.now()>=this._urls.expire_at&&this.refresh(),[2,this._urls]}}))}))},t.prototype.getServiceURL=function(t){return void 0===t&&(t="api"),o(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.getURLs()];case 1:switch(e=r.sent(),n="https://",t){case"api":return[2,n+e.api_server];case"engine":return[2,n+e.engine_server];default:throw new Error("Unknown service: "+t)}}}))}))},t.prototype.refresh=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:if(this._refreshing)return[2];this._refreshing=!0,e.label=1;case 1:return e.trys.push([1,,4,5]),[4,this._app.request({method:"GET",baseURL:"https://app-router.com",path:"2/route",query:{appId:this._app.appId}})];case 2:return t=e.sent(),this._urls=t.body,this._urls.expire_at=Date.now()+1e3*this._urls.ttl,[4,this._app.storage.setAsync(P,JSON.stringify(this._urls))];case 3:return e.sent(),[3,5];case 4:return this._refreshing=!1,[7];case 5:return[2]}}))}))},t.prototype.getDefaultServerURLs=function(){var t=z(this._app)?"lncld.net":"lncldglobal.com",e=this._app.appId.slice(0,8).toLowerCase();return{stats_server:e+".stats."+t,rtm_router_server:e+".rtm."+t,push_server:e+".push."+t,play_server:e+".play."+t,engine_server:e+".engine."+t,api_server:e+".api."+t,ttl:0,expire_at:0}},t}();var G=function(){function t(t){var e,n;this.appId=t.appId,this.appKey=t.appKey,this.serverURL=t.serverURL,this.masterKey=t.masterKey,this.useMasterKey=null!==(e=t.useMasterKey)&&void 0!==e&&e,this.production=null===(n=t.production)||void 0===n||n,D(this.appId,"The appId is required"),D(this.appKey,"The appKey is required"),z(this)&&D(this.serverURL,"The serverURL is required by CN App"),this.storage=new q(this.appId),this.serverURL||(this._router=new K(this))}return t.initDefault=function(e){D(!this._default,"Default app already initialized"),this._default=new t(e)},Object.defineProperty(t,"default",{get:function(){return D(this._default,"Default app not initialized"),this._default},enumerable:!1,configurable:!0}),t.prototype.request=function(t){var e,n;return o(this,void 0,void 0,(function(){var r,o,s,a,u,c,h,l;return i(this,(function(i){switch(i.label){case 0:return t.baseURL?[2,O(t)]:(r=t,(o=this.serverURL)?[3,2]:[4,this._router.getServiceURL(t.service)]);case 1:o=i.sent(),i.label=2;case 2:return r.baseURL=o,t.header=Object.assign(t.header||{},{"Content-Type":"application/json","X-LC-UA":Q("LeanCloud-JS-SDK"),"X-LC-Id":this.appId,"X-LC-Key":this.appKey}),s=this.useMasterKey,void 0!==(null===(e=t.options)||void 0===e?void 0:e.useMasterKey)&&(s=t.options.useMasterKey),s&&(t.header["X-LC-Key"]=this.masterKey+",master"),(null===(n=t.options)||void 0===n?void 0:n.sessionToken)?(a=t.options.sessionToken,[3,5]):[3,3];case 3:return[4,this.getSessionTokenAsync()];case 4:a=i.sent(),i.label=5;case 5:return a&&(t.header["X-LC-Session"]=a),this.production||(t.header["X-LC-Prod"]="0"),[4,O(t)];case 6:if((u=i.sent()).status>=400)throw c=u.body,h=c.code,l=c.error,new J(h,l);return[2,u]}}))}))},t.prototype.decode=function(t){return $.decode(this,t)},t.prototype.decodeObject=function(t,e){return $.decodeObject(this,t,e)},t.prototype.pause=function(){this.realtimeInstance&&this.realtimeInstance.pause()},t.prototype.resume=function(){this.realtimeInstance&&this.realtimeInstance.resume()},t.prototype.getSessionToken=function(){if(this.currentUser)return this.currentUser.sessionToken;var t=this.storage.get(S);return t?JSON.parse(t).sessionToken:null},t.prototype.getSessionTokenAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.currentUser?[2,this.currentUser.sessionToken]:[4,this.storage.getAsync(S)];case 1:return(t=e.sent())?[2,JSON.parse(t).sessionToken]:[2,null]}}))}))},t}();function Q(t){var e=t+"/5.0.0-dev";if(a.isSet){var n=a.get().platformInfo;if(n){var r=n.name,o=n.version;if(r)return o?e+" ("+r+"/"+o+")":e+" ("+r+")"}}return e}var H=function(){function t(){}return t.register=function(t,e){C.log("LC:Plugin:register",t),this.plugins[t]=e},t.requestAdapters=function(){var t=this;return a.isSet?Promise.resolve(a.get()):(this._adaptersPromise||(this._adaptersPromise=new Promise((function(e){t._adaptersRecevier=e})),a.on("set",this._adaptersRecevier)),this._adaptersPromise)},t.getLogger=function(){return C},t.plugins={},t}(),X=function(t,e){this.__type="GeoPoint","number"==typeof t?(this.latitude=t,this.longitude=e):(this.latitude=t.latitude,this.longitude=t.longitude)},V=function(){function t(t,e){this.app=t,this.className=e,this._where={},this._keys=[],this._order=[],this._include=[]}return t.and=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];D(e.length>1,"The and method require at least 2 queries");for(var r=1;r<e.length;++r)D(e[r].className===e[0].className,"All queries must belongs to same Class"),D(e[r].app.appId===e[0].app.appId,"All queries must belongs to same App");var o=new t(e[0].app,e[0].className);return o._where={$and:e.map((function(t){return t.toJSON()}))},o},t.or=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];D(e.length>1,"The or method require at least 2 queries");var r=t.and.apply(t,e);return r._where.$or=r._where.$and,delete r._where.$and,r},Object.defineProperty(t.prototype,"or",{get:function(){if(R(this._where))return this;var e=new t(this.app,this.className);return e._danglingOr=this,e},enumerable:!1,configurable:!0}),t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._keys=t,n},t.prototype.except=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._keys=t.map((function(t){return"-"+t})),n},t.prototype.orderBy=function(t,e){var n=this._clone();return"desc"===e?n._order.push("-"+t):n._order.push(t),n},t.prototype.skip=function(t){var e=this._clone();return e._skip=t,e},t.prototype.limit=function(t){var e=this._clone();return e._limit=t,e},t.prototype.include=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._include=t,n},t.prototype.returnACL=function(t){var e=this._clone();return e._returnACL=t,e},t.prototype.find=function(t){return o(this,void 0,void 0,(function(){var e,n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request(this._makeRequest(t))];case 1:return e=o.sent(),[2,null==(n=e.body.results)?void 0:n.map((function(t){return $.decodeObject(r.app,t,r.className)}))]}}))}))},t.prototype.first=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.limit(1).find(t)];case 1:return[2,(e=n.sent()).length?e[0]:null]}}))}))},t.prototype.count=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=this._makeRequest(t)).query.count=1,e.query.limit=0,[4,this.app.request(e)];case 1:return[2,n.sent().body.count]}}))}))},t.prototype.where=function(t,e,n){var r=this._clone();switch(e){case"==":r._whereEqualTo(t,n);break;case"!=":r._whereNotEqualTo(t,n);break;case">":r._whereGreaterThan(t,n);break;case">=":r._whereGreaterThanOrEqualTo(t,n);break;case"<":r._whereLessThan(t,n);break;case"<=":r._whereLessThanOrEqualTo(t,n);break;case"exists":r._whereExists(t);break;case"not-exists":r._whereNotExists(t);break;case"size-is":!function(t){D("number"==typeof t,"Need number, got "+t)}(n),r._whereSizeEqual(t,n);break;case"in":et(n),0==n._keys.length?r._whereMachesQuery(t,n):(D(1===n._keys.length,"The sub-query expect select only one key"),r._whereMatchesKeyInQuery(t,n._keys[0],n));break;case"not-in":et(n),0==n._keys.length?r._whereDoesNotMatchQuery(t,n):(D(1===n._keys.length,"The sub-query expect select only one key"),r._whereDoesNotMatcheKeyInQuery(t,n._keys[0],n));break;case"matches":r._whereMatches(t,n);break;case"starts-with":Y(n),r._whereStartsWith(t,n);break;case"ends-with":Y(n),r._whereEndsWith(t,n);break;case"contains":if("string"==typeof n)r._whereContains(t,n);else{if(!Array.isArray(n))throw new TypeError("Condition '"+e+"' accepts only string or array value");r._whereContainsAll(t,n)}break;case"contained-in":tt(n),r._whereContainedIn(t,n);break;case"not-contained-in":tt(n),r._whereNotContainedIn(t,n);break;case"near":!function(t){D(t instanceof X,"Need GeoPoint, got "+t)}(n),r._whereNear(t,n);break;case"within":!function(t){var e=t;if("object"==typeof e&&e.northeast instanceof X&&e.southwest instanceof X)return;throw new TypeError("Need GeoBox, got "+t)}(n),r._whereWithinGeoBox(t,n.southwest,n.northeast);break;case"within-radians":nt(n),r._whereWithinRadians(t,n.point,n.max,n.min);break;case"within-miles":nt(n),r._whereWithinMiles(t,n.point,n.max,n.min);break;case"within-kilometers":nt(n),r._whereWithinKilometers(t,n.point,n.max,n.min);break;default:throw new TypeError("Unsupported condition '"+e+"'")}return r},t.prototype.toJSON=function(){if(this._danglingOr){if(R(this._where))return this._danglingOr.toJSON();var e=this._danglingOr;this._danglingOr=null;var n=t.or(e,this).toJSON();return this._danglingOr=e,n}var o=r({},this._where);return Object.entries(o).forEach((function(t){var e=t[0],n=t[1];void 0!==n.$eq&&(o[e]=n.$eq)})),o},t.prototype.toString=function(){return JSON.stringify(this)},t.prototype.subscribe=function(){var t=H.plugins.LiveQuery;return D(t,"Query#subscribe need the LiveQuery plugin"),t.subscribe(this)},t.prototype._clone=function(e){return e||(e=new t(this.app,this.className)),Object.entries(this._where).forEach((function(t){var n=t[0],o=t[1];Array.isArray(o)?e._where[n]=s(o):e._where[n]=r({},o)})),e._keys=s(this._keys),e._order=s(this._order),e._include=s(this._include),e._skip=this._skip,e._limit=this._limit,e._returnACL=this._returnACL,e._danglingOr=this._danglingOr,e},t.prototype._makeRequest=function(t){var e={path:"1.1/classes/"+this.className,query:{limit:this._limit,skip:this._skip,returnACL:this._returnACL},options:t},n=this.toString();return"{}"!==n&&(e.query.where=n),this._include.length&&(e.query.include=this._include.join(",")),this._order.length&&(e.query.order=this._order.join(",")),this._keys.length&&(e.query.keys=this._keys.join(",")),e},t.prototype._addCondition=function(t,e,n){this._where[t]||(this._where[t]={}),this._where[t][e]=$.encode(n)},t.prototype._clearAllCondition=function(t){this._where[t]&&(this._where[t]={})},t.prototype._whereEqualTo=function(t,e){this._clearAllCondition(t),this._addCondition(t,"$eq",e)},t.prototype._whereNotEqualTo=function(t,e){this._addCondition(t,"$ne",e)},t.prototype._whereGreaterThan=function(t,e){this._addCondition(t,"$gt",e)},t.prototype._whereGreaterThanOrEqualTo=function(t,e){this._addCondition(t,"$gte",e)},t.prototype._whereLessThan=function(t,e){this._addCondition(t,"$lt",e)},t.prototype._whereLessThanOrEqualTo=function(t,e){this._addCondition(t,"$lte",e)},t.prototype._whereExists=function(t){this._addCondition(t,"$exists",!0)},t.prototype._whereNotExists=function(t){this._addCondition(t,"$exists",!1)},t.prototype._whereSizeEqual=function(t,e){this._addCondition(t,"$size",e)},t.prototype._whereMatchesKeyInQuery=function(t,e,n){this._addCondition(t,"$select",{key:e,query:{className:n.className,where:n.toJSON()}})},t.prototype._whereDoesNotMatcheKeyInQuery=function(t,e,n){this._addCondition(t,"$dontSelect",{key:e,query:{className:n.className,where:n.toJSON()}})},t.prototype._whereMachesQuery=function(t,e){this._addCondition(t,"$inQuery",{className:e.className,where:e.toJSON()})},t.prototype._whereDoesNotMatchQuery=function(t,e){this._addCondition(t,"$notInQuery",{className:e.className,where:e.toJSON()})},t.prototype._whereMatches=function(t,e){var n,r="";"string"==typeof e?n=e:(x(e,"RegExp")?n=e.source:(n=e.regexp,e.ignoreBlank&&(r+="x")),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s")),this._addCondition(t,"$regex",n),r&&this._addCondition(t,"$options",r)},t.prototype._whereStartsWith=function(t,e){this._whereMatches(t,"^"+Z(e))},t.prototype._whereEndsWith=function(t,e){this._whereMatches(t,Z(e)+"$")},t.prototype._whereContains=function(t,e){this._whereMatches(t,Z(e))},t.prototype._whereContainsAll=function(t,e){this._addCondition(t,"$all",e)},t.prototype._whereContainedIn=function(t,e){this._addCondition(t,"$in",e)},t.prototype._whereNotContainedIn=function(t,e){this._addCondition(t,"$nin",e)},t.prototype._whereNear=function(t,e){this._addCondition(t,"$nearSphere",e)},t.prototype._whereWithinGeoBox=function(t,e,n){this._addCondition(t,"$within",{$box:[e,n]})},t.prototype._whereWithinRadians=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInRadians",n),void 0!==r&&this._addCondition(t,"$minDistanceInRadians",r)},t.prototype._whereWithinMiles=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInMiles",n),void 0!==r&&this._addCondition(t,"$minDistanceInMiles",r)},t.prototype._whereWithinKilometers=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInKilometers",n),void 0!==r&&this._addCondition(t,"$minDistanceInKilometers",r)},t}();function Z(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"}function Y(t){D("string"==typeof t,"Need string, got "+t)}function tt(t){D(Array.isArray(t),"Need array, got "+t)}function et(t){D(t instanceof V,"Need Query, got "+t)}function nt(t){var e=t;if(!("object"==typeof e&&e.point instanceof X&&"number"==typeof e.max)||void 0!==e.min&&"number"!=typeof e.min)throw new TypeError("Need GeoDistance, got "+t)}var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"_apiPath",{get:function(){return"1.1/classes/"+this.className},enumerable:!1,configurable:!0}),e.prototype.object=function(t){return new W(this.app,this.className,t)},e.prototype.add=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:this._apiPath,body:$.encode(M(t)),query:{fetchWhenSave:null==e?void 0:e.fetch},options:e})];case 1:return n=r.sent(),[2,$.decodeObject(this.app,n.body,this.className)]}}))}))},e}(V),ot=function(){function t(){}return t.unset=function(){return{__op:"Delete"}},t.increment=function(t){return void 0===t&&(t=1),{__op:"Increment",amount:t}},t.decrement=function(t){return void 0===t&&(t=1),{__op:"Decrement",amount:t}},t.add=function(t){return Array.isArray(t)||(t=[t]),{__op:"Add",objects:t}},t.addUnique=function(t){return Array.isArray(t)||(t=[t]),{__op:"AddUnique",objects:t}},t.remove=function(t){return Array.isArray(t)||(t=[t]),{__op:"Remove",objects:t}},t.bitAnd=function(t){return{__op:"BitAnd",value:t}},t.bitOr=function(t){return{__op:"BitOr",value:t}},t.bitXor=function(t){return{__op:"BitXor",value:t}},t.addRelation=function(t){return Array.isArray(t)||(t=[t]),{__op:"AddRelation",objects:t.map((function(t){return t.toPointer()}))}},t.removeRelation=function(e){var n=t.addRelation(e);return n.__op="RemoveRelation",n},t}();$.setCreator("_User",(function(t,e){return new at(t,e)}));var it=function(){function t(){}return t.set=function(t,e){var n=$.encode(e,!0);t.storage.set(S,JSON.stringify(n)),t.currentUser=e},t.setAsync=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=$.encode(e,!0),[4,t.storage.setAsync(S,JSON.stringify(n))];case 1:return r.sent(),t.currentUser=e,[2]}}))}))},t.get=function(t){if(!t.currentUser){var e=t.storage.get(S);e&&(t.currentUser=$.decode(t,JSON.parse(e)))}return t.currentUser},t.getAsync=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.currentUser?[3,2]:[4,t.storage.getAsync(S)];case 1:(e=n.sent())&&(t.currentUser=$.decode(t,JSON.parse(e))),n.label=2;case 2:return[2,t.currentUser]}}))}))},t.remove=function(t){t.storage.delete(S),t.currentUser=null},t.removeAsync=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,t.storage.deleteAsync(S)];case 1:return e.sent(),t.currentUser=null,[2]}}))}))},t.syncData=function(t,e){var n=t.storage.get(S);if(n){var r=JSON.parse(n);e(r),delete r.password,t.storage.set(S,JSON.stringify(r)),t.currentUser=null}},t.syncDataAsync=function(t,e){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,t.storage.getAsync(S)];case 1:return(n=o.sent())?(r=JSON.parse(n),e(r),delete r.password,[4,t.storage.setAsync(S,JSON.stringify(r))]):[2];case 2:return o.sent(),t.currentUser=null,[2]}}))}))},t}(),st=function(t){function e(e,n){return t.call(this,e,"_User",n)||this}return n(e,t),Object.defineProperty(e.prototype,"aclKey",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),e.prototype.isCurrent=function(){var t=it.get(this.app);return this.objectId===(null==t?void 0:t.objectId)},e.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,it.getAsync(this.app)];case 1:return t=e.sent(),[2,this.objectId===(null==t?void 0:t.objectId)]}}))}))},e.prototype.get=function(e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,t.prototype.get.call(this,e)];case 1:return n=r.sent(),[4,this.isCurrentAsync()];case 2:return r.sent()?[4,it.syncDataAsync(this.app,(function(t){Object.assign(t,$.encode(n,!0))}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2,n]}}))}))},e.prototype.update=function(e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,t.prototype.update.call(this,e,n)];case 1:return r=o.sent(),[4,this.isCurrentAsync()];case 2:return o.sent()?[4,it.syncDataAsync(this.app,(function(t){Object.assign(t,e,$.encode(r,!0))}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2,r]}}))}))},e.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,t.prototype.delete.call(this,e)];case 1:return n.sent(),[4,this.isCurrentAsync()];case 2:return n.sent()?[4,it.removeAsync(this.app)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},e.prototype.getRoles=function(){return new V(this.app,"_Role").where("users","==",this).find()},e}(W),at=function(t){function e(e,n){var r=t.call(this,e,"_User",n)||this;return r._ref=new st(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"sessionToken",{get:function(){return this.data.sessionToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aclKey",{get:function(){return this._ref.aclKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_anonymousId",{get:function(){var t;return null===(t=this.data.authData.anonymous)||void 0===t?void 0:t.id},enumerable:!1,configurable:!0}),e.prototype.isCurrent=function(){if(this.isAnonymous()){var t=it.get(this.app);return this._anonymousId===t._anonymousId}return this._ref.isCurrent()},e.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.isAnonymous()?[4,it.getAsync(this.app)]:[3,2];case 1:return t=e.sent(),[2,this._anonymousId===t._anonymousId];case 2:return[2,this._ref.isCurrentAsync()]}}))}))},e.prototype.isAnonymous=function(){var t;return!!(null===(t=this.data.authData)||void 0===t?void 0:t.anonymous)},e.prototype.isAuthenticated=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.request({path:"1.1/users/me",options:{sessionToken:this.sessionToken}})];case 1:return e.sent(),[2,!0];case 2:if(211!==(t=e.sent()).code)throw t;return[2,!1];case 3:return[2]}}))}))},e.prototype.updatePassword=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/updatePassword",body:{old_password:t,new_password:e},options:r({sessionToken:this.sessionToken},n)})];case 1:return o=i.sent(),this.data.sessionToken=o.body.sessionToken,[4,this.isCurrentAsync()];case 2:return i.sent()?[4,it.syncDataAsync(this.app,(function(t){t.sessionToken=s.sessionToken}))]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},e.prototype.associateWithAuthData=function(t,e,n){var o;return this.update({authData:(o={},o[t]=e,o)},r({fetch:!0},n))},e.prototype.associateWithAuthDataAndUnionId=function(t,e,n,r){var o,i;return Object.assign(e,{unionid:n,platform:null!==(o=null==r?void 0:r.unionIdPlatform)&&void 0!==o?o:"weixin",main_account:null!==(i=null==r?void 0:r.asMainAccount)&&void 0!==i&&i}),this.associateWithAuthData(t,e,r)},e.prototype.associateWithMiniApp=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,a.get().getAuthInfo(t)];case 1:return e=n.sent(),[2,this.associateWithAuthData(e.provider,e.authData,t)]}}))}))},e.prototype.dissociateAuthData=function(t){var e;return this.update(((e={})["authData."+t]=ot.unset(),e),{fetch:!0})},e.prototype.signUp=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:if(!this.isAnonymous())throw new Error("User#signUp can only be invoked by an anonymous user");return D(t.username,"The username must be provided"),D(t.password,"The password must be provided"),[4,this.isCurrentAsync()];case 1:return n.sent()&&it.syncDataAsync(this.app,(function(t){delete t.authData.anonymous})),[2,this.update(t,e)]}}))}))},e.prototype.refreshSessionToken=function(t){return o(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/refreshSessionToken",options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return e=o.sent(),this.data.sessionToken=e.body.sessionToken,[4,this.isCurrentAsync()];case 2:return o.sent()?[4,it.syncDataAsync(this.app,(function(t){t.sessionToken=n.sessionToken}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},e.prototype.follow=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return D(this.sessionToken,"Cannot create friendship for an unauthorized user"),n="string"==typeof t?t:t.objectId,[4,this.app.request({method:"POST",path:"1.1/users/"+this.objectId+"/friendship/"+n,body:null==e?void 0:e.data,options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},e.prototype.unfollow=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return D(this.sessionToken,"Cannot remove friendship for an unauthorized user"),n="string"==typeof t?t:t.objectId,[4,this.app.request({method:"DELETE",path:"1.1/users/"+this.objectId+"/friendship/"+n,options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},e.prototype.getRoles=function(){return this._ref.getRoles()},e.prototype.get=function(t){return this._ref.get(r({sessionToken:this.sessionToken},t))},e.prototype.update=function(t,e){return this._ref.update(t,r({sessionToken:this.sessionToken},e))},e.prototype.delete=function(t){return this._ref.delete(r({sessionToken:this.sessionToken},t))},e}(B),ut="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),ct=new Uint8Array(16);function ht(){if(!ut)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ut(ct)}var lt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function pt(t){return"string"==typeof t&&lt.test(t)}for(var dt=[],ft=0;ft<256;++ft)dt.push((ft+256).toString(16).substr(1));function yt(t,e,n){var r=(t=t||{}).random||(t.rng||ht)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=r[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(dt[t[e+0]]+dt[t[e+1]]+dt[t[e+2]]+dt[t[e+3]]+"-"+dt[t[e+4]]+dt[t[e+5]]+"-"+dt[t[e+6]]+dt[t[e+7]]+"-"+dt[t[e+8]]+dt[t[e+9]]+"-"+dt[t[e+10]]+dt[t[e+11]]+dt[t[e+12]]+dt[t[e+13]]+dt[t[e+14]]+dt[t[e+15]]).toLowerCase();if(!pt(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var vt=function(t){function e(e){return t.call(this,e,"_User")||this}return n(e,t),Object.defineProperty(e.prototype,"_apiPath",{get:function(){return"1.1/users"},enumerable:!1,configurable:!0}),e.object=function(t){return new st(G.default,t)},e.current=function(){return it.get(G.default)},e.currentAsync=function(){return it.getAsync(G.default)},e.become=function(t,n){return new e(G.default).become(t,n)},e.signUp=function(t,n){return new e(G.default).signUp(t,n)},e.signUpOrLoginWithMobilePhone=function(t,n){return new e(G.default).signUpOrLoginWithMobilePhone(t,n)},e.loginWithData=function(t,n){return new e(G.default).loginWithData(t,n)},e.login=function(t,n,r){return new e(G.default).login(t,n,r)},e.loginWithAuthData=function(t,n,r){return new e(G.default).loginWithAuthData(t,n,r)},e.loginAnonymously=function(t){return new e(G.default).loginAnonymously(t)},e.loginWithEmail=function(t,n,r){return new e(G.default).loginWithEmail(t,n,r)},e.loginWithMobilePhone=function(t,n,r){return new e(G.default).loginWithMobilePhone(t,n,r)},e.loginWithMobilePhoneSMSCode=function(t,n,r){return new e(G.default).loginWithMobilePhoneSMSCode(t,n,r)},e.loginWithAuthDataAndUnionId=function(t,n,r,o){return new e(G.default).loginWithAuthDataAndUnionId(t,n,r,o)},e.loginWithMiniApp=function(t){return new e(G.default).loginWithMiniApp(t)},e.logOut=function(){new e(G.default).logOut()},e.logOutAsync=function(){return new e(G.default).logOutAsync()},e.requestEmailVerify=function(t,n){return new e(G.default).requestEmailVerify(t,n)},e.requestLoginSMSCode=function(t,n){return new e(G.default).requestLoginSMSCode(t,n)},e.requestMobilePhoneVerify=function(t,n){return new e(G.default).requestMobilePhoneVerify(t,n)},e.requestPasswordReset=function(t,n){return new e(G.default).requestPasswordReset(t,n)},e.requestPasswordResetBySMSCode=function(t,n){return new e(G.default).requestPasswordResetBySMSCode(t,n)},e.resetPasswordBySMSCode=function(t,n,r){return new e(G.default).resetPasswordBySMSCode(t,n,r)},e.verifyMobilePhone=function(t,n){return new e(G.default).verifyMobilePhone(t,n)},e.requestChangePhoneNumber=function(t,n){return new e(G.default).requestChangePhoneNumber(t,n)},e.changePhoneNumber=function(t,n,r){return new e(G.default).changePhoneNumber(t,n,r)},e.prototype.object=function(t){return new st(this.app,t)},e.prototype.current=function(){return it.get(this.app)},e.prototype.currentAsync=function(){return it.getAsync(this.app)},e.prototype.become=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({path:"1.1/users/me",options:r(r({},e),{sessionToken:t})})];case 1:return n=o.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.signUp=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:M(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.signUpOrLoginWithMobilePhone=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/usersByMobilePhone",body:M(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.loginWithData=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/login",body:M(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.login=function(t,e,n){return this.loginWithData({username:t,password:e},n)},e.prototype.loginWithAuthData=function(t,e,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:{authData:(o={},o[t]=e,o)},query:{failOnNotExist:null==n?void 0:n.failOnNotExist},options:n})];case 1:return r=i.sent(),[2,this._decodeAndSetToCurrent(r.body)]}}))}))},e.prototype.loginAnonymously=function(t){return this.loginWithAuthData("anonymous",{id:yt()},t)},e.prototype.loginWithEmail=function(t,e,n){return this.loginWithData({email:t,password:e},n)},e.prototype.loginWithMobilePhone=function(t,e,n){return this.loginWithData({mobilePhoneNumber:t,password:e},n)},e.prototype.loginWithMobilePhoneSMSCode=function(t,e,n){return this.loginWithData({mobilePhoneNumber:t,smsCode:e},n)},e.prototype.loginWithAuthDataAndUnionId=function(t,e,n,r){return e=Object.assign({},e,{platform:null==r?void 0:r.unionIdPlatform,main_account:null==r?void 0:r.asMainAccount,unionid:n}),this.loginWithAuthData(t,e,r)},e.prototype.loginWithMiniApp=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,a.get().getAuthInfo(t)];case 1:return e=n.sent(),[2,this.loginWithAuthData(e.provider,e.authData,t)]}}))}))},e.prototype.logOut=function(){it.remove(this.app)},e.prototype.logOutAsync=function(){return it.removeAsync(this.app)},e.prototype.requestEmailVerify=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestEmailVerify",body:{email:t},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestLoginSMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestLoginSmsCode",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestMobilePhoneVerify=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestMobilePhoneVerify",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestPasswordReset=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordReset",body:{email:t},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestPasswordResetBySMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordResetBySmsCode",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.resetPasswordBySMSCode=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/resetPasswordBySmsCode/"+t,body:{password:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype.verifyMobilePhone=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifyMobilePhone/"+t,options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestChangePhoneNumber=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestChangePhoneNumber",body:{mobilePhoneNumber:t,ttl:null==e?void 0:e.ttl},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.changePhoneNumber=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/changePhoneNumber",body:{mobilePhoneNumber:t,code:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype._decodeAndSetToCurrent=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=$.decodeObject(this.app,t,this.className),[4,it.setAsync(this.app,e)];case 1:return n.sent(),[2,e]}}))}))},e}(rt);function bt(t){return t instanceof gt||t instanceof mt}$.setCreator("_Role",(function(t,e){return new gt(t,e)}));var mt=function(t){function e(e,n){return t.call(this,e,"_Role",n)||this}return n(e,t),e.prototype.add=function(t,e){return o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return Array.isArray(t)||(t=[t]),n=[],r=[],t.forEach((function(t){return bt(t)?r.push(t):n.push(t)})),o={},n.length&&(o.users=ot.addRelation(n)),r.length&&(o.roles=ot.addRelation(r)),[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:o,options:e})];case 1:return i.sent(),[2]}}))}))},e.prototype.remove=function(t,e){return o(this,void 0,void 0,(function(){var n,r,o;return i(this,(function(i){switch(i.label){case 0:return Array.isArray(t)||(t=[t]),n=[],r=[],t.forEach((function(t){return bt(t)?r.push(t):n.push(t)})),o={},n.length&&(o.users=ot.removeRelation(n)),r.length&&(o.roles=ot.removeRelation(r)),[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:o,options:e})];case 1:return i.sent(),[2]}}))}))},e.prototype.getUsersQuery=function(){return new V(this.app,"_User").where("$relatedTo","==",{key:"users",object:this})},e.prototype.getRolesQuery=function(){return new V(this.app,"_Role").where("$relatedTo","==",{key:"roles",object:this})},e.prototype.getUsers=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.getUsersQuery().find(t)]}))}))},e.prototype.getRoles=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.getRolesQuery().find(t)]}))}))},e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,e,n)},e}(W),gt=function(t){function e(e,n){var r=t.call(this,e,"_Role",n)||this;return r._ref=new mt(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aclKey",{get:function(){return"role:"+this.data.name},enumerable:!1,configurable:!0}),e.prototype.add=function(t,e){return this._ref.add(t,e)},e.prototype.remove=function(t,e){return this._ref.remove(t,e)},e.prototype.getUsersQuery=function(){return this._ref.getUsersQuery()},e.prototype.getRolesQuery=function(){return this._ref.getRolesQuery()},e.prototype.getUsers=function(t){return this._ref.getUsers(t)},e.prototype.getRoles=function(t){return this._ref.getRoles(t)},e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,e,n)},e}(B),_t=function(t){function e(e){return t.call(this,e,"_Role")||this}return n(e,t),e.object=function(t){return new mt(G.default,t)},e.add=function(t,n){return new e(G.default).add(t,n)},e.prototype.object=function(t){return new mt(this.app,t)},e.prototype.add=function(t,e){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=r({},t),t.roles&&(n.roles=ot.addRelation(t.roles)),t.users&&(n.users=ot.addRelation(t.users)),[4,this.app.request({method:"POST",path:"1.1/roles",body:n,options:e})];case 1:return o=i.sent(),[2,$.decodeObject(this.app,o.body,this.className)]}}))}))},e}(rt),wt=l((function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,r,o,i,s,a=.75*t.length,u=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var h=new ArrayBuffer(a),l=new Uint8Array(h);for(e=0;e<u;e+=4)r=n[t.charCodeAt(e)],o=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],l[c++]=r<<2|o>>4,l[c++]=(15&o)<<4|i>>2,l[c++]=(3&i)<<6|63&s;return h}}()})),Ct=function(){function t(){}return t.upload=function(t,e,n,s){return function(t,e){return o(this,void 0,void 0,(function(){var n,o,s,u;return i(this,(function(i){switch(i.label){case 0:return n=a.get().upload,o=A(t),C.log("LC:Upload:send","%O",t),u=k,[4,n(o,e,r(r({},t.options),{method:t.method||"POST",headers:t.header,data:t.form}))];case 1:return s=u.apply(void 0,[i.sent()]),C.log("LC:Upload:recv","%O",s),[2,s]}}))}))}({method:"POST",header:null==s?void 0:s.header,baseURL:n.upload_url,form:{name:t,key:n.key,token:n.token},options:s},{field:"file",name:t,data:e})},t}(),Tt=function(){function t(){}return t.upload=function(t,e,n,o){return O({method:"PUT",baseURL:n.upload_url,header:r({"Content-Type":n.mime_type,"Cache-Control":"public, max-age=31536000"},null==o?void 0:o.header),body:e,options:o})},t}();$.setCreator("_File",(function(t,e){return new At(t,e)}));var Ot=function(t){function e(e,n){return t.call(this,e,"_File",n)||this}return n(e,t),e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,{name:e.name,url:e.url,mime_type:e.mime_type,metaData:e.metaData,ACL:e.ACL},n)},e}(W),At=function(t){function e(e,n){var r=t.call(this,e,"_File",n)||this;return r._ref=new Ot(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var t;return null===(t=this.data.metaData)||void 0===t?void 0:t.size},enumerable:!1,configurable:!0}),e.prototype.thumbnailURL=function(t,e,n,r,o){void 0===n&&(n=100),void 0===r&&(r=!0),void 0===o&&(o="png");var i=r?2:1;return this.url+"?imageView/"+i+"/w/"+t+"/h/"+e+"/q/"+n+"/format/"+o},e.prototype.get=function(t){return this._ref.get(t)},e.prototype.update=function(t,e){return this._ref.update(t,e)},e}(B);var kt=function(t){function e(e){return t.call(this,e,"_File")||this}return n(e,t),e.object=function(t){return new Ot(G.default,t)},e.upload=function(t,n,r){return new e(G.default).upload(t,n,r)},e.uploadWithURL=function(t,n,r){return new e(G.default).uploadWithURL(t,n,r)},e.prototype.object=function(t){return new Ot(this.app,t)},e.prototype.upload=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s,a,u,c,h;return i(this,(function(i){switch(i.label){case 0:return e=this._parseFileData(e),o=r({},null==n?void 0:n.metaData),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),o.size||(o.size=this._getFileSize(e)),[4,this._getFileTokens(t,null==n?void 0:n.mime,null==n?void 0:n.ACL,o)];case 4:a=i.sent(),u=this._getFileProvider(a.provider),i.label=5;case 5:return i.trys.push([5,8,,10]),[4,u.upload(t,e,a,n)];case 6:return i.sent(),[4,this._invokeFileCallback(a.token,!0)];case 7:return i.sent(),[3,10];case 8:return c=i.sent(),[4,this._invokeFileCallback(a.token,!1)];case 9:throw i.sent(),c;case 10:return(h=new At(this.app,a.objectId)).data=r(r({},a),{name:t,metaData:o}),h.createdAt=new Date(a.createdAt),h.updatedAt=h.createdAt,delete h.data.createdAt,[2,h]}}))}))},e.prototype.uploadWithURL=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return o=r(r({},null==n?void 0:n.metaData),{__source:"external"}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this.app.request({method:"POST",path:"1.1/files/"+t,body:{name:t,url:e,ACL:null==n?void 0:n.ACL,mime_type:null==n?void 0:n.mime,metaData:o}})];case 4:return a=i.sent(),(u=new At(this.app,a.body.objectId)).data=r(r({},a.body),{metaData:o}),u.createdAt=new Date(u.data.createdAt),u.updatedAt=u.createdAt,delete u.data.createdAt,[2,u]}}))}))},e.prototype._parseFileData=function(t){if(Array.isArray(t)){var e=new Uint8Array(t.length);if(t.forEach((function(t,n){return e[n]=t})),"undefined"!=typeof Blob)return new Blob([e]);if("undefined"!=typeof Buffer)return Buffer.from(e);throw new Error("Current platform cannot upload byte array encoded file")}if(t.base64){var n=function(t){if(t.startsWith("data:")){var e=t.split(","),n=e[0],r=e[1];if(null==n?void 0:n.endsWith("base64"))return r}return t}(t.base64);if("undefined"!=typeof Blob)return new Blob([wt.decode(n)]);if("undefined"!=typeof Buffer)return Buffer.from(n,"base64");throw new Error("Current platform cannot upload base64 encoded file")}return t.blob?t.blob:t},e.prototype._getFileSize=function(t){return"undefined"!=typeof Blob&&t instanceof Blob?t.size:"undefined"!=typeof Buffer&&Buffer.isBuffer(t)?t.length:void 0},e.prototype._getFileTokens=function(t,e,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/fileTokens",body:{name:t,ACL:n,metaData:r,mime_type:e}})];case 1:return[2,o.sent().body]}}))}))},e.prototype._getFileProvider=function(t){switch(t){case"qiniu":return Ct;case"s3":return Tt;default:throw new Error("Unsupported file provider: "+t)}},e.prototype._invokeFileCallback=function(t,e){return this.app.request({method:"POST",path:"1.1/fileCallback",body:{token:t,result:e}})},e}(rt),St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.sendToFollowers=function(t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){return[2,new e(G.default).sendToFollowers(t,n)]}))}))},e.sendToUser=function(t,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){return[2,new e(G.default).sendToUser(t,n,r)]}))}))},e.deleteInboxStatus=function(t,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){return[2,new e(G.default).deleteInboxStatus(t,n)]}))}))},e.getUnreadCount=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new e(G.default).getUnreadCount(t)]}))}))},e.resetUnreadCount=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new e(G.default).resetUnreadCount(t)]}))}))},e.prototype.sendToFollowers=function(t,e){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return[4,it.getAsync(this.app)];case 1:return D(n=i.sent(),"No user is logged in"),[4,this.app.request({method:"POST",path:"1.1/statuses",query:{fetchWhenSave:!0},body:{query:{className:"_Follower",keys:"follower",where:{user:n.toPointer()}},data:r(r({},t),{source:n.toPointer()}),inboxType:null==e?void 0:e.inboxType},options:e})];case 2:return o=i.sent(),[2,$.decodeObject(this.app,o.body,"_Status")]}}))}))},e.prototype.sendToUser=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s,a;return i(this,(function(i){switch(i.label){case 0:return[4,it.getAsync(this.app)];case 1:return D(o=i.sent(),"No user is logged in"),s="string"==typeof t?t:t.objectId,[4,this.app.request({method:"POST",path:"1.1/statuses",body:{query:{className:"_User",where:{objectId:s}},data:r(r({},e),{source:o.toPointer()}),inboxType:(null==n?void 0:n.inboxType)||"private"},options:n})];case 2:return a=i.sent(),[2,$.decodeObject(this.app,a.body,"_Status")]}}))}))},e.prototype.deleteInboxStatus=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,it.getAsync(this.app)];case 1:return D(n=r.sent(),"No user is logged in"),[4,this.app.request({method:"DELETE",path:"1.1/subscribe/statuses/inbox",query:{owner:JSON.stringify(n.toPointer()),inboxType:null==e?void 0:e.inboxType,messageId:t},options:e})];case 2:return r.sent(),[2]}}))}))},e.prototype.getUnreadCount=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,it.getAsync(this.app)];case 1:return D(e=n.sent(),"No user is logged in"),[4,this.app.request({method:"GET",path:"1.1/subscribe/statuses/count",query:{owner:JSON.stringify(e.toPointer()),inboxType:null==t?void 0:t.inboxType},options:t})];case 2:return[2,n.sent().body]}}))}))},e.prototype.resetUnreadCount=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,it.getAsync(this.app)];case 1:return D(e=n.sent(),"No user is logged in"),[4,this.app.request({method:"POST",path:"1.1/subscribe/statuses/resetUnreadCount",query:{owner:JSON.stringify(e.toPointer()),inboxType:null==t?void 0:t.inboxType},options:t})];case 2:return n.sent(),[2]}}))}))},e}(function(t){function e(e){return void 0===e&&(e=G.default),t.call(this,e,"_Status")||this}return n(e,t),e.prototype.whereStatusOwner=function(t){var e=this._clone();return e._statusOwner="string"==typeof t?{__type:"Pointer",className:"_User",objectId:t}:t.toPointer(),e._whereEqualTo("source",e._statusOwner),e},e.prototype.whereInboxOwner=function(t){D(t.sessionToken,"Cannot query inbox for an unauthorized user");var e=this._clone();return e._inboxOwner=t,e},e.prototype.whereInboxType=function(t){var e=this._clone();return e._inboxType=t,e},e.prototype.whereSinceId=function(t){var e=this._clone();return e._sinceId=t,e},e.prototype.whereMaxId=function(t){var e=this._clone();return e._maxId=t,e},e.prototype._clone=function(n){return n||(n=new e(this.app)),(n=t.prototype._clone.call(this,n))._statusOwner=this._statusOwner,n._inboxOwner=this._inboxOwner,n._inboxType=this._inboxType,n._sinceId=this._sinceId,n._maxId=this._maxId,n},e.prototype._makeRequest=function(e){var n=t.prototype._makeRequest.call(this,e);return this._inboxOwner&&(D(void 0===this._statusOwner,"Cannot query both inboxOwner and statusOwner"),n.path="1.1/subscribe/statuses",n.options?n.options.sessionToken||(n.options.sessionToken=this._inboxOwner.sessionToken):n.options={sessionToken:this._inboxOwner.sessionToken},n.query.owner=JSON.stringify(this._inboxOwner.toPointer()),n.query.inboxType=this._inboxType,n.query.sinceId=this._sinceId,n.query.maxId=this._maxId),n},e}(V)),Pt=function(){function t(t,e){var n,r,o=this;this._app=t,this.sid=e.sid,this.hits=null!==(n=e.hits)&&void 0!==n?n:0,this.data=null===(r=e.results)||void 0===r?void 0:r.map((function(t){return $.decodeObject(o._app,t)}))}return t.prototype.next=function(e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return 0===this.data.length?[2,this]:[4,this._app.request({method:"GET",path:"1.1/search/select",query:{sid:this.sid},options:e})];case 1:return n=r.sent(),[2,new t(this._app,n.body)]}}))}))},t}(),Et=function(){function t(){this._sortFields=[]}return t.prototype.orderBy=function(t,e,n){var r,o={order:e};return(null==n?void 0:n.mode)&&(o.mode=n.mode),(null==n?void 0:n.missing)&&(o.missing="_"+n.missing),this._sortFields.push(((r={})[t]=o,r)),this},t.prototype.whereNear=function(t,e,n){var o,i=r(r({},n),((o={})[t]={lat:e.latitude,lon:e.longitude},o));return this._sortFields.push({_geo_distance:i}),this},t.prototype.toString=function(){return JSON.stringify(this._sortFields)},t}(),jt=function(){function t(t,e){this._order=[],t instanceof G&&(this.app=t),"string"==typeof t&&(this.className=t),void 0===this.app&&(this.app=G.default),void 0===this.className&&(this.className=e)}return t.prototype.queryString=function(t){var e=this._clone();return e._q=t,e},t.prototype.skip=function(t){var e=this._clone();return e._skip=t,e},t.prototype.limit=function(t){var e=this._clone();return e._limit=t,e},t.prototype.sid=function(t){var e=this._clone();return e._sid=t,e},t.prototype.fields=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._fields=t,n},t.prototype.highlights=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._highlights=t,n},t.prototype.include=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._include=t,n},t.prototype.find=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request(this._makeRequest(t))];case 1:return e=n.sent(),[2,new Pt(this.app,e.body)]}}))}))},t.prototype.orderBy=function(t,e){var n=this._clone();return"desc"===e?n._order.push("-"+t):n._order.push(t),n},t.prototype.sortBy=function(t){var e=this._clone();return e._sort=t.toString(),e},t.prototype._makeRequest=function(t){var e,n={method:"GET",path:"1.1/search/select",query:{q:this._q,skip:this._skip,limit:this._limit,sid:this._sid,clazz:this.className,sort:this._sort},options:t};return this._fields&&(n.query.fields=this._fields.join(",")),this._highlights&&(n.query.highlights=this._highlights.join(",")),this._include&&(n.query.include=this._include.join(",")),this._order.length&&(n.query.order=null===(e=this._order)||void 0===e?void 0:e.join(",")),n},t.prototype._clone=function(){var e=new t(this.app,this.className);return e._q=this._q,e._skip=this._skip,e._limit=this._limit,e._sid=this._sid,e._fields=this._fields,e._highlights=this._highlights,e._sort=this._sort,e._include=this._include,e._order=s(this._order),e},t}(),qt=function(){function t(t){this.app=t}return t.request=function(e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return e instanceof G?[4,(r=new t(e)).refresh(n)]:[3,2];case 1:return o.sent(),[2,r];case 2:return[4,(r=new t(G.default)).refresh(e)];case 3:return o.sent(),[2,r]}}))}))},t.prototype.refresh=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return this.validateToken=null,[4,this.app.request({method:"GET",path:"1.1/requestCaptcha",query:{width:null==t?void 0:t.width,height:null==t?void 0:t.height,size:null==t?void 0:t.size,ttl:null==t?void 0:t.ttl},options:t})];case 1:return e=n.sent(),this.token=e.body.captcha_token,this.url=e.body.captcha_url,[2]}}))}))},t.prototype.verify=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:if(!this.token)throw new Error("The captcha token is empty, you should call refresh first");return[4,this.app.request({method:"POST",path:"1.1/verifyCaptcha",body:{captcha_code:t,captcha_token:this.token},options:e})];case 1:return n=r.sent(),this.validateToken=n.body.validate_token,[2,this.validateToken]}}))}))},t.prototype.bind=function(t){this._binder||(this._binder=new xt(this,t)),this._binder.bind()},t.prototype.unbind=function(){this._binder&&this._binder.unbind()},t}(),xt=function(){function t(t,e){this.captcha=t,"string"==typeof e.image?this.image=document.getElementById(e.image):this.image=e.image,"string"==typeof e.textInput?this.input=document.getElementById(e.textInput):this.input=e.textInput,"string"==typeof e.verifyButton?this.button=document.getElementById(e.verifyButton):this.button=e.verifyButton,this.onSuccess=e.success,this.onError=e.error,this.onRefresh=this.refresh.bind(this),this.onVerify=this.verify.bind(this)}return t.prototype.refresh=function(){var t;return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.captcha.refresh()];case 1:return n.sent(),this.image.src=this.captcha.url,this.input&&(this.input.value="",this.input.focus()),[3,3];case 2:return e=n.sent(),null===(t=this.onError)||void 0===t||t.call(this,e),[3,3];case 3:return[2]}}))}))},t.prototype.verify=function(){var t;return o(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.input.value,[4,this.captcha.verify(e)];case 1:return r.sent(),this.onSuccess&&this.onSuccess(this.captcha.validateToken),[3,3];case 2:return n=r.sent(),null===(t=this.onError)||void 0===t||t.call(this,n),[3,3];case 3:return[2]}}))}))},t.prototype.bind=function(){this.image&&(this.image.src=this.captcha.url,this.image.addEventListener("click",this.onRefresh)),this.input&&this.button&&this.button.addEventListener("click",this.onVerify)},t.prototype.unbind=function(){this.image&&this.image.removeEventListener("click",this.onRefresh),this.button&&this.button.removeEventListener("click",this.onVerify)},t}(),Nt=function(){function t(t){this.app=t}return t.requestSMSCode=function(e,n){return new t(G.default).requestSMSCode(e,n)},t.verifySMSCode=function(e,n,r){return new t(G.default).verifySMSCode(e,n,r)},t.run=function(e,n,r){return new t(G.default).run(e,n,r)},t.rpc=function(e,n,r){return new t(G.default).rpc(e,n,r)},t.prototype.requestSMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestSmsCode",body:r(r({},null==e?void 0:e.variables),{mobilePhoneNumber:t,smsType:null==e?void 0:e.smsType,ttl:null==e?void 0:e.ttl,name:null==e?void 0:e.name,op:null==e?void 0:e.op,template:null==e?void 0:e.template,sign:null==e?void 0:e.sign,validate_token:null==e?void 0:e.validateToken}),options:e})];case 1:return n.sent(),[2]}}))}))},t.prototype.verifySMSCode=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifySmsCode/"+e,body:{mobilePhoneNumber:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.run=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({service:"engine",method:"POST",path:"1.1/functions/"+t,body:$.encode(e,!0),options:n})];case 1:return[2,r.sent().body.result]}}))}))},t.prototype.rpc=function(t,e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({service:"engine",method:"POST",path:"1.1/call/"+t,body:$.encode(e,!0),options:n})];case 1:return r=o.sent(),[2,$.decode(this.app,r.body.result)]}}))}))},t}(),It=function(){function t(t){this.app=t}return t.send=function(e,n){return new t(G.default).send(e,n)},t.prototype.send=function(t,e){var n,r,s;return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:if((null==e?void 0:e.expirationTime)&&(null==e?void 0:e.expirationInterval))throw new Error("Both expirationTime and expirationInterval cannot be set");return[4,this.app.request({service:"push",method:"POST",path:"1.1/push",body:{data:t,where:null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.toJSON(),channels:null==e?void 0:e.channels,push_time:null===(r=null==e?void 0:e.pushTime)||void 0===r?void 0:r.toISOString(),expiration_time:null===(s=null==e?void 0:e.expirationTime)||void 0===s?void 0:s.toISOString(),expiration_interval:null==e?void 0:e.expirationInterval,notification_id:null==e?void 0:e.notificationId,req_id:null==e?void 0:e.reqId,prod:null==e?void 0:e.prod,topic:null==e?void 0:e.topic,apns_team_id:null==e?void 0:e.apnsTeamId,flow_control:null==e?void 0:e.flowControl,_notificationChannel:null==e?void 0:e.notificationChannel},options:e})];case 1:return o.sent(),[2]}}))}))},t}(),Rt=l((function(t,e){var n=c&&c.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="AbortError",e}return n(e,t),e}(Error);e.AbortError=r}));const Dt=new WeakMap,Lt=new WeakMap;function Ut(t){const e=Dt.get(t);return console.assert(null!=e,"'this' is expected an Event object, but got",t),e}function Ft(t){null==t.passiveListener?t.event.cancelable&&(t.canceled=!0,"function"==typeof t.event.preventDefault&&t.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",t.passiveListener)}function Mt(t,e){Dt.set(this,{eventTarget:t,event:e,eventPhase:2,currentTarget:t,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:e.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(e);for(let t=0;t<n.length;++t){const e=n[t];e in this||Object.defineProperty(this,e,Wt(e))}}function Wt(t){return{get(){return Ut(this).event[t]},set(e){Ut(this).event[t]=e},configurable:!0,enumerable:!0}}function Bt(t){return{value(){const e=Ut(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function $t(t){if(null==t||t===Object.prototype)return Mt;let e=Lt.get(t);return null==e&&(e=function(t,e){const n=Object.keys(e);if(0===n.length)return t;function r(e,n){t.call(this,e,n)}r.prototype=Object.create(t.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let o=0;o<n.length;++o){const i=n[o];if(!(i in t.prototype)){const t="function"==typeof Object.getOwnPropertyDescriptor(e,i).value;Object.defineProperty(r.prototype,i,t?Bt(i):Wt(i))}}return r}($t(Object.getPrototypeOf(t)),t),Lt.set(t,e)),e}function Jt(t){return Ut(t).immediateStopped}function zt(t,e){Ut(t).passiveListener=e}Mt.prototype={get type(){return Ut(this).event.type},get target(){return Ut(this).eventTarget},get currentTarget(){return Ut(this).currentTarget},composedPath(){const t=Ut(this).currentTarget;return null==t?[]:[t]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return Ut(this).eventPhase},stopPropagation(){const t=Ut(this);t.stopped=!0,"function"==typeof t.event.stopPropagation&&t.event.stopPropagation()},stopImmediatePropagation(){const t=Ut(this);t.stopped=!0,t.immediateStopped=!0,"function"==typeof t.event.stopImmediatePropagation&&t.event.stopImmediatePropagation()},get bubbles(){return Boolean(Ut(this).event.bubbles)},get cancelable(){return Boolean(Ut(this).event.cancelable)},preventDefault(){Ft(Ut(this))},get defaultPrevented(){return Ut(this).canceled},get composed(){return Boolean(Ut(this).event.composed)},get timeStamp(){return Ut(this).timeStamp},get srcElement(){return Ut(this).eventTarget},get cancelBubble(){return Ut(this).stopped},set cancelBubble(t){if(!t)return;const e=Ut(this);e.stopped=!0,"boolean"==typeof e.event.cancelBubble&&(e.event.cancelBubble=!0)},get returnValue(){return!Ut(this).canceled},set returnValue(t){t||Ft(Ut(this))},initEvent(){}},Object.defineProperty(Mt.prototype,"constructor",{value:Mt,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(Mt.prototype,window.Event.prototype),Lt.set(window.Event.prototype,Mt));const Kt=new WeakMap;function Gt(t){return null!==t&&"object"==typeof t}function Qt(t){const e=Kt.get(t);if(null==e)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function Ht(t,e){Object.defineProperty(t,"on"+e,function(t){return{get(){let e=Qt(this).get(t);for(;null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set(e){"function"==typeof e||Gt(e)||(e=null);const n=Qt(this);let r=null,o=n.get(t);for(;null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(t,o.next):n.delete(t):r=o,o=o.next;if(null!==e){const o={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(t,o):r.next=o}},configurable:!0,enumerable:!0}}(e))}function Xt(t){function e(){Vt.call(this)}e.prototype=Object.create(Vt.prototype,{constructor:{value:e,configurable:!0,writable:!0}});for(let n=0;n<t.length;++n)Ht(e.prototype,t[n]);return e}function Vt(){if(!(this instanceof Vt)){if(1===arguments.length&&Array.isArray(arguments[0]))return Xt(arguments[0]);if(arguments.length>0){const t=new Array(arguments.length);for(let e=0;e<arguments.length;++e)t[e]=arguments[e];return Xt(t)}throw new TypeError("Cannot call a class as a function")}Kt.set(this,new Map)}Vt.prototype={addEventListener(t,e,n){if(null==e)return;if("function"!=typeof e&&!Gt(e))throw new TypeError("'listener' should be a function or an object.");const r=Qt(this),o=Gt(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:e,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null};let a=r.get(t);if(void 0===a)return void r.set(t,s);let u=null;for(;null!=a;){if(a.listener===e&&a.listenerType===i)return;u=a,a=a.next}u.next=s},removeEventListener(t,e,n){if(null==e)return;const r=Qt(this),o=(Gt(n)?Boolean(n.capture):Boolean(n))?1:2;let i=null,s=r.get(t);for(;null!=s;){if(s.listener===e&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(t,s.next):r.delete(t));i=s,s=s.next}},dispatchEvent(t){if(null==t||"string"!=typeof t.type)throw new TypeError('"event.type" should be a string.');const e=Qt(this),n=t.type;let r=e.get(n);if(null==r)return!0;const o=function(t,e){return new($t(Object.getPrototypeOf(e)))(t,e)}(this,t);let i=null;for(;null!=r;){if(r.once?null!==i?i.next=r.next:null!==r.next?e.set(n,r.next):e.delete(n):i=r,zt(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(Jt(o))break;r=r.next}return zt(o,null),function(t,e){Ut(t).eventPhase=e}(o,0),function(t,e){Ut(t).currentTarget=e}(o,null),!o.defaultPrevented}},Object.defineProperty(Vt.prototype,"constructor",{value:Vt,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(Vt.prototype,window.EventTarget.prototype);var Zt=Object.freeze({__proto__:null,default:Vt,defineEventAttribute:Ht,EventTarget:Vt}),Yt=l((function(t,e){var n=c&&c.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(n,r){var o=t.call(this)||this;if(o._readyState=e.CLOSED,!n)throw new TypeError("Failed to construct 'WebSocket': url required");return o._url=n,o._protocol=r,o}return n(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._protocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._readyState},enumerable:!0,configurable:!0}),e.CONNECTING=0,e.OPEN=1,e.CLOSING=2,e.CLOSED=3,e}(Zt.EventTarget("open","error","message","close"));e.WS=r})),te=l((function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),n(Rt),n(Yt)})),ee=l((function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<r.length;o++)if((n=r[o])===e||n.fn===e){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}})),ne=ie;ie.default=ie,ie.stable=ae,ie.stableStringify=ae;var re=[],oe=[];function ie(t,e,n){var r;for(!function t(e,n,r,o){var i;if("object"==typeof e&&null!==e){for(i=0;i<r.length;i++)if(r[i]===e){var s=Object.getOwnPropertyDescriptor(o,n);return void(void 0!==s.get?s.configurable?(Object.defineProperty(o,n,{value:"[Circular]"}),re.push([o,n,e,s])):oe.push([e,n]):(o[n]="[Circular]",re.push([o,n,e])))}if(r.push(e),Array.isArray(e))for(i=0;i<e.length;i++)t(e[i],i,r,e);else{var a=Object.keys(e);for(i=0;i<a.length;i++){var u=a[i];t(e[u],u,r,e)}}r.pop()}}(t,"",[],void 0),r=0===oe.length?JSON.stringify(t,e,n):JSON.stringify(t,ue(e),n);0!==re.length;){var o=re.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}return r}function se(t,e){return t<e?-1:t>e?1:0}function ae(t,e,n){var r,o=function t(e,n,r,o){var i;if("object"==typeof e&&null!==e){for(i=0;i<r.length;i++)if(r[i]===e){var s=Object.getOwnPropertyDescriptor(o,n);return void(void 0!==s.get?s.configurable?(Object.defineProperty(o,n,{value:"[Circular]"}),re.push([o,n,e,s])):oe.push([e,n]):(o[n]="[Circular]",re.push([o,n,e])))}if("function"==typeof e.toJSON)return;if(r.push(e),Array.isArray(e))for(i=0;i<e.length;i++)t(e[i],i,r,e);else{var a={},u=Object.keys(e).sort(se);for(i=0;i<u.length;i++){var c=u[i];t(e[c],c,r,e),a[c]=e[c]}if(void 0===o)return a;re.push([o,n,e]),o[n]=a}r.pop()}}(t,"",[],void 0)||t;for(r=0===oe.length?JSON.stringify(o,e,n):JSON.stringify(o,ue(e),n);0!==re.length;){var i=re.pop();4===i.length?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}return r}function ue(t){return t=void 0!==t?t:function(t,e){return e},function(e,n){if(oe.length>0)for(var r=0;r<oe.length;r++){var o=oe[r];if(o[1]===e&&o[0]===n){n="[Circular]",oe.splice(r,1);break}}return t.call(this,e,n)}}function ce(t){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var he=function(t){return null!==t&&"object"===ce(t)};function le(t){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var pe=de;function de(t){if(t)return function(t){for(var e in de.prototype)Object.prototype.hasOwnProperty.call(de.prototype,e)&&(t[e]=de.prototype[e]);return t}(t)}de.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),clearTimeout(this._uploadTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,delete this._uploadTimeoutTimer,this},de.prototype.parse=function(t){return this._parser=t,this},de.prototype.responseType=function(t){return this._responseType=t,this},de.prototype.serialize=function(t){return this._serializer=t,this},de.prototype.timeout=function(t){if(!t||"object"!==le(t))return this._timeout=t,this._responseTimeout=0,this._uploadTimeout=0,this;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;case"upload":this._uploadTimeout=t.upload;break;default:console.warn("Unknown timeout option",e)}return this},de.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var fe=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];de.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var n=this._retryCallback(t,e);if(!0===n)return!0;if(!1===n)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!==e.status)return!0;if(t){if(t.code&&fe.includes(t.code))return!0;if(t.timeout&&"ECONNABORTED"===t.code)return!0;if(t.crossDomain)return!0}return!1},de.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this.timedoutError=null,this._end()},de.prototype.then=function(t,e){var n=this;if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){r.on("abort",(function(){if(!(n._maxRetries&&n._maxRetries>n._retries))if(n.timedout&&n.timedoutError)e(n.timedoutError);else{var t=new Error("Aborted");t.code="ABORTED",t.status=n.status,t.method=n.method,t.url=n.url,e(t)}})),r.end((function(n,r){n?e(n):t(r)}))}))}return this._fullfilledPromise.then(t,e)},de.prototype.catch=function(t){return this.then(void 0,t)},de.prototype.use=function(t){return t(this),this},de.prototype.ok=function(t){if("function"!=typeof t)throw new Error("Callback required");return this._okCallback=t,this},de.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},de.prototype.get=function(t){return this._header[t.toLowerCase()]},de.prototype.getHeader=de.prototype.get,de.prototype.set=function(t,e){if(he(t)){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},de.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},de.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data)throw new Error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()");if(he(t)){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.field(n,t[n]);return this}if(Array.isArray(e)){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&this.field(t,e[r]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=String(e)),this._getFormData().append(t,e),this},de.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},de.prototype._auth=function(t,e,n,r){switch(n.type){case"basic":this.set("Authorization","Basic ".concat(r("".concat(t,":").concat(e))));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer ".concat(t))}return this},de.prototype.withCredentials=function(t){return void 0===t&&(t=!0),this._withCredentials=t,this},de.prototype.redirects=function(t){return this._maxRedirects=t,this},de.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw new TypeError("Invalid argument");return this._maxResponseSize=t,this},de.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},de.prototype.send=function(t){var e=he(t),n=this._header["content-type"];if(this._formData)throw new Error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()");if(e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw new Error("Can't merge these send calls");if(e&&he(this._data))for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(this._data[r]=t[r]);else"string"==typeof t?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"===n?this._data?"".concat(this._data,"&").concat(t):t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||n||this.type("json"),this},de.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},de.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.includes("?")?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var n=this.url.slice(e+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.slice(0,e)+"?"+n.join("&")}}},de.prototype._appendQueryString=function(){console.warn("Unsupported")},de.prototype._timeoutError=function(t,e,n){if(!this._aborted){var r=new Error("".concat(t+e,"ms exceeded"));r.timeout=e,r.code="ECONNABORTED",r.errno=n,this.timedout=!0,this.timedoutError=r,this.abort(),this.callback(r)}},de.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))};var ye=function(t){return t.split(/ *; */).shift()},ve=function(t){return t.split(/ *; */).reduce((function(t,e){var n=e.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(t[r]=o),t}),{})},be=function(t){return t.split(/ *, */).reduce((function(t,e){var n=e.split(/ *; */),r=n[0].slice(1,-1);return t[n[1].split(/ *= */)[1].slice(1,-1)]=r,t}),{})},me=ge;function ge(t){if(t)return function(t){for(var e in ge.prototype)Object.prototype.hasOwnProperty.call(ge.prototype,e)&&(t[e]=ge.prototype[e]);return t}(t)}function _e(t){return function(t){if(Array.isArray(t))return we(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return we(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ce(){this._defaults=[]}ge.prototype.get=function(t){return this.header[t.toLowerCase()]},ge.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=ye(e);var n=ve(e);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(this[r]=n[r]);this.links={};try{t.link&&(this.links=be(t.link))}catch(t){}},ge.prototype._setStatusProperties=function(t){var e=t/100|0;this.statusCode=t,this.status=this.statusCode,this.statusType=e,this.info=1===e,this.ok=2===e,this.redirect=3===e,this.clientError=4===e,this.serverError=5===e,this.error=(4===e||5===e)&&this.toError(),this.created=201===t,this.accepted=202===t,this.noContent=204===t,this.badRequest=400===t,this.unauthorized=401===t,this.notAcceptable=406===t,this.forbidden=403===t,this.notFound=404===t,this.unprocessableEntity=422===t},["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert","disableTLSCerts"].forEach((function(t){Ce.prototype[t]=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this._defaults.push({fn:t,args:n}),this}})),Ce.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,_e(e.args))}))};var Te=Ce,Oe=l((function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r;function o(){}"undefined"!=typeof window?r=window:"undefined"==typeof self?(console.warn("Using browser-only version of superagent in non-browser environment"),r=void 0):r=self,t.exports=function(t,n){return"function"==typeof n?new e.Request("GET",t).end(n):1===arguments.length?new e.Request("GET",t):new e.Request(t,n)};var i=e=t.exports;e.Request=p,i.getXHR=function(){if(r.XMLHttpRequest&&(!r.location||"file:"!==r.location.protocol||!r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw new Error("Browser-only version of superagent could not find XHR")};var s="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function a(t){if(!he(t))return t;var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&u(e,n,t[n]);return e.join("&")}function u(t,e,n){if(void 0!==n)if(null!==n)if(Array.isArray(n))n.forEach((function(n){u(t,e,n)}));else if(he(n))for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&u(t,"".concat(e,"[").concat(r,"]"),n[r]);else t.push(encodeURI(e)+"="+encodeURIComponent(n));else t.push(encodeURI(e))}function c(t){for(var e,n,r={},o=t.split("&"),i=0,s=o.length;i<s;++i)-1===(n=(e=o[i]).indexOf("="))?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function h(t){return/[/+]json($|[^-\w])/.test(t)}function l(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!==this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.headers=function(t){for(var e,n,r,o,i=t.split(/\r?\n/),a={},u=0,c=i.length;u<c;++u)-1!==(e=(n=i[u]).indexOf(":"))&&(r=n.slice(0,e).toLowerCase(),o=s(n.slice(e+1)),a[r]=o);return a}(this.xhr.getAllResponseHeaders()),this.header=this.headers,this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"===this.req.method?null:this._parseBody(this.text?this.text:this.xhr.response)}function p(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,r=null;try{r=new l(n)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,n.xhr?(e.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",r);try{n._isResponseOK(r)||(t=new Error(r.statusText||r.text||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=r,t.status=r.status,n.callback(t,r)):n.callback(null,r)}))}function d(t,e,n){var r=i("DELETE",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}i.serializeObject=a,i.parseString=c,i.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},i.serialize={"application/x-www-form-urlencoded":a,"application/json":ne},i.parse={"application/x-www-form-urlencoded":c,"application/json":JSON.parse},me(l.prototype),l.prototype._parseBody=function(t){var e=i.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&h(this.type)&&(e=i.parse["application/json"]),e&&t&&(t.length>0||t instanceof Object)?e(t):null)},l.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot ".concat(e," ").concat(n," (").concat(this.status,")"),o=new Error(r);return o.status=this.status,o.method=e,o.url=n,o},i.Response=l,ee(p.prototype),pe(p.prototype),p.prototype.type=function(t){return this.set("Content-Type",i.types[t]||t),this},p.prototype.accept=function(t){return this.set("Accept",i.types[t]||t),this},p.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"===n(e)&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var o=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,o)},p.prototype.query=function(t){return"string"!=typeof t&&(t=a(t)),t&&this._query.push(t),this},p.prototype.attach=function(t,e,n){if(e){if(this._data)throw new Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,n||e.name)}return this},p.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},p.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var n=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),n(t,e)},p.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},p.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},p.prototype.ca=p.prototype.agent,p.prototype.buffer=p.prototype.ca,p.prototype.write=function(){throw new Error("Streaming is not supported in browser version of superagent")},p.prototype.pipe=p.prototype.write,p.prototype._isHost=function(t){return t&&"object"===n(t)&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},p.prototype.end=function(t){this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||o,this._finalizeQueryString(),this._end()},p.prototype._setUploadTimeout=function(){var t=this;this._uploadTimeout&&!this._uploadTimeoutTimer&&(this._uploadTimeoutTimer=setTimeout((function(){t._timeoutError("Upload timeout of ",t._uploadTimeout,"ETIMEDOUT")}),this._uploadTimeout))},p.prototype._end=function(){if(this._aborted)return this.callback(new Error("The request has been aborted even before .end() was called"));var t=this;this.xhr=i.getXHR();var e=this.xhr,n=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var n=e.readyState;if(n>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4===n){var r;try{r=e.status}catch(t){r=0}if(!r){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var r=function(e,n){n.total>0&&(n.percent=n.loaded/n.total*100,100===n.percent&&clearTimeout(t._uploadTimeoutTimer)),n.direction=e,t.emit("progress",n)};if(this.hasListeners("progress"))try{e.addEventListener("progress",r.bind(null,"download")),e.upload&&e.upload.addEventListener("progress",r.bind(null,"upload"))}catch(t){}e.upload&&this._setUploadTimeout();try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!==this.method&&"HEAD"!==this.method&&"string"!=typeof n&&!this._isHost(n)){var o=this._header["content-type"],s=this._serializer||i.serialize[o?o.split(";")[0]:""];!s&&h(o)&&(s=i.serialize["application/json"]),s&&(n=s(n))}for(var a in this.header)null!==this.header[a]&&Object.prototype.hasOwnProperty.call(this.header,a)&&e.setRequestHeader(a,this.header[a]);this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0===n?null:n)},i.agent=function(){return new Te},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){Te.prototype[t.toLowerCase()]=function(e,n){var r=new i.Request(t,e);return this._setDefaults(r),n&&r.end(n),r}})),Te.prototype.del=Te.prototype.delete,i.get=function(t,e,n){var r=i("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},i.head=function(t,e,n){var r=i("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},i.options=function(t,e,n){var r=i("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.del=d,i.delete=d,i.patch=function(t,e,n){var r=i("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.post=function(t,e,n){var r=i("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.put=function(t,e,n){var r=i("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}})),Ae=l((function(t,e){var n=c&&c.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=c&&c.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function o(t){return{ok:t.ok,status:t.status,headers:t.header,data:t.body}}Object.defineProperty(e,"__esModule",{value:!0}),e.request=function(t,e){var i=this;void 0===e&&(e={});var s=e.method,a=void 0===s?"GET":s,u=e.data,c=e.headers,h=e.onprogress,l=e.signal;if(null==l?void 0:l.aborted)return Promise.reject(new te.AbortError("Request aborted"));var p=Oe(a,t);return c&&p.set(c),h&&p.on("progress",h),new Promise((function(t,e){return n(i,void 0,void 0,(function(){var n,i,s;return r(this,(function(r){switch(r.label){case 0:l&&l.addEventListener("abort",(function(){e(new te.AbortError("Request aborted")),p.abort()})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,p.send(u)];case 2:return n=r.sent(),t(o(n)),[3,4];case 3:return i=r.sent(),(s=i).response?t(o(s.response)):e(i),[3,4];case 4:return[2]}}))}))}))},e.upload=function(t,e,i){void 0===i&&(i={});var s=i.method,a=void 0===s?"POST":s,u=i.data,c=i.headers,h=i.onprogress,l=i.signal;if(null==l?void 0:l.aborted)return Promise.reject(new te.AbortError("Request aborted"));var p=Oe(a,t).attach(e.field,e.data,e.name);return u&&p.field(u),c&&p.set(c),h&&p.on("progress",h),new Promise((function(t,e){return n(void 0,void 0,void 0,(function(){var n,i,s;return r(this,(function(r){switch(r.label){case 0:l&&l.addEventListener("abort",(function(){e(new te.AbortError("Request aborted")),p.abort()})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,p];case 2:return n=r.sent(),t(o(n)),[3,4];case 3:return i=r.sent(),(s=i).response?t(o(s.response)):e(i),[3,4];case 4:return[2]}}))}))}))}})),ke=l((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=Ae.request,e.upload=Ae.upload,e.storage=window.localStorage,e.WebSocket=window.WebSocket,e.platformInfo={name:"Browser"}})),Se=h(ke);u(Object.freeze(Object.assign(Object.create(null),ke,{default:Se}))),t.ACL=F,t.App=G,t.CLASS=function(t){return new rt(G.default,t)},t.Captcha=qt,t.Class=rt,t.Cloud=Nt,t.File=kt,t.GeoPoint=X,t.Op=ot,t.Push=It,t.Query=V,t.Role=_t,t.SearchQuery=jt,t.SearchSortBuilder=Et,t.Status=St,t.User=vt,t.debug=C,t.init=function(t){G.initDefault(t)},t.setAdapters=u,t.use=function(t){t.install(H)},Object.defineProperty(t,"__esModule",{value:!0})}));
